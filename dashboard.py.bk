import streamlit as st
import requests

API_URL = "http://localhost:8000/api/v1"

st.title("Dashboard - API Metrics")

def get_metrics():
    try:
        r = requests.get(f"{API_URL}/metrics")
        if r.status_code == 200:
            return r.json()
    except:
        return None

metrics = get_metrics()

if metrics:
    total = metrics.get("total_requests", 0)
    total_latency = metrics.get("total_latency", 0) * 1000  # ms
    avg_latency = metrics.get("avg_latency", 0) * 1000      # ms
    st.write(f"📊 Total de requisições: {total}")
    st.write(f"⏱️ Latência total: {total_latency:.2f} ms")
    st.write(f"📈 Latência média: {avg_latency:.2f} ms")
else:
    st.error("Falha ao obter métricas.")
